---
title: Playbook migration với Prisma và PostgreSQL
excerpt: Checklist mình dùng để tránh lỗi khi chạy migration trên môi trường thật.
category: Prisma / PostgreSQL
tags:
  - prisma
  - postgres
author: Phạm Thành Nam
publishDate: 2025-11-08T10:30:00
---

## 1. Tách schema

Đầu tiên mình tách schema thành các module (auth, billing, content). Mỗi module là một file `.prisma` riêng, sau đó merge bằng `prisma generate`. Điều này giúp review dễ hơn.

## 2. Migration an toàn

```bash
prisma migrate dev --name add-billing-status
prisma migrate deploy
```

- Kiểm tra migration SQL được tạo, đặc biệt là `DROP` hoặc `ALTER`.
- Nếu cần thay đổi dữ liệu lớn, viết script `prisma.$transaction` đi kèm.

## 3. Giám sát

- Bật PG `log_statement = 'ddl'` để theo dõi live.
- Dùng `pg_stat_activity` kiểm tra lock kéo dài.

Sau vài dự án, playbook này giúp đội mình gần như không còn rollback migration gấp nữa.
