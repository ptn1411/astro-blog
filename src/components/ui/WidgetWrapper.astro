---
import type { HTMLTag } from 'astro/types';
import { twMerge } from 'tailwind-merge';
import type { Widget } from '~/types';
import Background from './Background.astro';

export interface Props extends Widget {
  containerClass?: string;
  ['as']?: HTMLTag;
}

const {
  id,
  isDark = false,
  containerClass = '',
  bg,
  as = 'section',
  animation,
  animationEngine: propEngine,
  animationType: propType,
  animationDuration: propDuration,
  animationDelay: propDelay,
  loopAnimation: propLoop,
  ...rest
} = Astro.props;

const engine = animation?.engine || propEngine || 'gsap';
const type = animation?.type || propType;
const duration = animation?.duration || propDuration || 1000;
const delay = animation?.delay || propDelay || 0;
const loop = animation?.loop || propLoop;

const WrapperTag = as;

// Determine if we should use the new animation system
const hasAnimation = !!type;
---

<WrapperTag class="relative not-prose scroll-mt-[72px]" {...id ? { id } : {}} {...rest}>
  <div class="absolute inset-0 pointer-events-none -z-[1]" aria-hidden="true">
    <slot name="bg">
      {bg ? <Fragment set:html={bg} /> : <Background isDark={isDark} />}
    </slot>
  </div>
  <div
    class:list={[
      twMerge(
        'relative mx-auto max-w-7xl px-4 md:px-6 py-12 md:py-16 lg:py-20 text-default',
        // Only apply legacy classes if NOT using new animation system
        !hasAnimation &&
          'intersect-once intersect-quarter intersect-no-queue motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade',
        containerClass
      ),
      { dark: isDark },
    ]}
    {...hasAnimation
      ? {
          'data-animation-engine': engine,
          'data-animation-type': type,
          'data-animation-duration': duration,
          'data-animation-delay': delay,
          'data-loop-animation': loop,
        }
      : {}}>
    <slot />
  </div>
</WrapperTag>
