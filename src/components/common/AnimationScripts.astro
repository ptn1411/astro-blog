---

---

<script is:inline>
  import { playAnimeAnimation, playGSAPAnimation, playLoopAnimation } from '~/components/admin/story/animations';

  const initAnimations = () => {
    const animatedElements = document.querySelectorAll(
      '[data-animation-engine="gsap"], [data-animation-engine="anime"]'
    );

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (!entry.isIntersecting) return;

          const el = entry.target;
          const engine = el.dataset.animationEngine;
          const type = el.dataset.animationType;
          const duration = Number(el.dataset.animationDuration || 1000);
          const delay = Number(el.dataset.animationDelay || 0);
          const loop = el.dataset.loopAnimation;

          if (type) {
            if (engine === 'gsap') {
              playGSAPAnimation(el, type, { duration: duration / 1000, delay: delay / 1000 });
            } else {
              playAnimeAnimation(el, type, { duration, delay });
            }
          }

          if (loop) {
            setTimeout(() => playLoopAnimation(el, loop, engine), duration + delay);
          }

          observer.unobserve(el);
        });
      },
      { threshold: 0.2 }
    );

    animatedElements.forEach((el) => observer.observe(el));
  };

  document.addEventListener('DOMContentLoaded', initAnimations);
  document.addEventListener('astro:page-load', initAnimations);
</script>
