---
import Button from '~/components/ui/Button.astro';
import Headline from '~/components/ui/Headline.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import type { Widget } from '~/types';

export interface Props extends Widget {
  title?: string;
  subtitle?: string;
  tagline?: string;
  events?: {
    title: string;
    description?: string;
    date: string;
    time?: string;
    location?: string;
    link?: { text?: string; href: string };
  }[];
}

const {
  title = '',
  subtitle = '',
  tagline = '',
  events = [],
  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
  ...rest
} = Astro.props;

function formatDate(dateStr: string) {
  const date = new Date(dateStr);
  return {
    day: date.getDate(),
    month: date.toLocaleString('default', { month: 'short' }),
    year: date.getFullYear(),
  };
}
---

<WidgetWrapper
  id={id}
  isDark={isDark}
  containerClass={`max-w-4xl mx-auto ${classes?.container ?? ''}`}
  bg={bg}
  {...rest}>
  <Headline title={title} subtitle={subtitle} tagline={tagline} />

  <div class="space-y-6 px-4">
    {
      events.map((event) => {
        const { day, month, year } = formatDate(event.date);
        return (
          <div class="flex gap-6 p-6 bg-white dark:bg-slate-900 rounded-lg shadow-md border border-gray-100 dark:border-slate-800">
            <div class="flex-shrink-0 text-center w-20">
              <div class="text-3xl font-bold text-blue-600 dark:text-blue-400">{day}</div>
              <div class="text-sm font-semibold uppercase text-gray-500 dark:text-slate-400">
                {month} {year}
              </div>
            </div>
            <div class="flex-grow">
              <h4 class="text-xl font-bold mb-2 dark:text-white">{event.title}</h4>
              {[event.time, event.location].filter(Boolean).length > 0 && (
                <div class="flex flex-wrap gap-4 text-sm text-gray-500 dark:text-slate-400 mb-3">
                  {event.time && <div class="flex items-center gap-1">ğŸ•’ {event.time}</div>}
                  {event.location && <div class="flex items-center gap-1">ğŸ“ {event.location}</div>}
                </div>
              )}
              {event.description && <p class="text-gray-600 dark:text-slate-400 mb-4">{event.description}</p>}
              {event.link && (
                <Button {...event.link} variant="link" class="text-blue-600 dark:text-blue-400 p-0 h-auto" />
              )}
            </div>
          </div>
        );
      })
    }
  </div>
</WidgetWrapper>
