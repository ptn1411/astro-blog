---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import type { Widget } from '~/types';

export interface Props extends Widget {
  title?: string;
  subtitle?: string;
  date: string;
}

const {
  title = '',
  subtitle = '',
  date,
  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
  ...rest
} = Astro.props;
---

<WidgetWrapper
  id={id}
  isDark={isDark}
  containerClass={`max-w-4xl mx-auto text-center ${classes?.container ?? ''}`}
  bg={bg}
  {...rest}>
  <div class="px-4">
    {title && <h2 class="text-3xl md:text-4xl font-bold mb-4 dark:text-white" set:html={title} />}
    {subtitle && <p class="text-xl text-muted mb-10 dark:text-slate-400" set:html={subtitle} />}

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" data-countdown={date}>
      {
        ['days', 'hours', 'minutes', 'seconds'].map((label) => (
          <div class="bg-white dark:bg-slate-900 rounded-lg shadow-md p-4 border border-gray-100 dark:border-slate-800">
            <div class="text-4xl md:text-5xl font-bold text-blue-600 dark:text-blue-400 mb-1" id={`countdown-${label}`}>
              00
            </div>
            <div class="text-xs uppercase tracking-widest text-gray-500 dark:text-slate-500 font-semibold">{label}</div>
          </div>
        ))
      }
    </div>
  </div>

  <script is:inline>
    function updateCountdown() {
      const el = document.querySelector('[data-countdown]');
      if (!el) return;

      const targetDate = new Date(el.dataset.countdown).getTime();
      const now = new Date().getTime();
      const distance = targetDate - now;

      if (distance < 0) {
        return;
      }

      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);

      document.getElementById('countdown-days').innerText = String(days).padStart(2, '0');
      document.getElementById('countdown-hours').innerText = String(hours).padStart(2, '0');
      document.getElementById('countdown-minutes').innerText = String(minutes).padStart(2, '0');
      document.getElementById('countdown-seconds').innerText = String(seconds).padStart(2, '0');
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();
  </script>
</WidgetWrapper>
