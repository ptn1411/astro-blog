---
import Headline from '~/components/ui/Headline.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import type { Widget } from '~/types';

export interface Props extends Widget {
  title?: string;
  subtitle?: string;
  tagline?: string;
  plans?: {
    name: string;
    features: { name: string; included: boolean }[];
  }[];
}

const {
  title = '',
  subtitle = '',
  tagline = '',
  plans = [],
  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
  ...rest
} = Astro.props;

// Get all unique feature names from the first plan
const featureNames = plans[0]?.features?.map((f) => f.name) || [];
---

<WidgetWrapper
  id={id}
  isDark={isDark}
  containerClass={`max-w-7xl mx-auto ${classes?.container ?? ''}`}
  bg={bg}
  {...rest}>
  <Headline title={title} subtitle={subtitle} tagline={tagline} />

  <div class="overflow-x-auto px-4">
    <table class="w-full border-collapse">
      <thead>
        <tr>
          <th class="p-4 text-left bg-gray-50 dark:bg-slate-800 border dark:border-slate-700 dark:text-white"
            >Feature</th
          >
          {
            plans.map((plan) => (
              <th class="p-4 text-center bg-gray-50 dark:bg-slate-800 border dark:border-slate-700 dark:text-white">
                {plan.name}
              </th>
            ))
          }
        </tr>
      </thead>
      <tbody>
        {
          featureNames.map((name) => (
            <tr>
              <td class="p-4 border dark:border-slate-700 dark:text-slate-300">{name}</td>
              {plans.map((plan) => {
                const feature = plan.features.find((f) => f.name === name);
                return (
                  <td class="p-4 text-center border dark:border-slate-700">
                    {feature?.included ? (
                      <span class="text-green-500 text-xl font-bold">✓</span>
                    ) : (
                      <span class="text-red-500 text-xl font-bold">✕</span>
                    )}
                  </td>
                );
              })}
            </tr>
          ))
        }
      </tbody>
    </table>
  </div>
</WidgetWrapper>
