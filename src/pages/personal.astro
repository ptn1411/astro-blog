---
import logo from '~/assets/favicons/logo.png';

import BlogLatestPosts from '~/components/widgets/BlogLatestPosts.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import Content from '~/components/widgets/Content.astro';
import Features3 from '~/components/widgets/Features3.astro';
import Header from '~/components/widgets/Header.astro';
import Hero from '~/components/widgets/Hero.astro';
import Steps from '~/components/widgets/Steps.astro';
import Testimonials from '~/components/widgets/Testimonials.astro';
import Layout from '~/layouts/PageLayout.astro';
import { getCanonical, getPermalink } from '~/utils/permalinks';
import { buildPersonSchema } from '~/utils/structured-data';

const canonical = String(getCanonical(Astro.url.pathname));

const metadata = {
  title: 'Phạm Thành Nam - Lập trình viên Fullstack & Maker',
  description:
    'Portfolio dự án cá nhân của Phạm Thành Nam: sản phẩm số, công cụ nội bộ và trải nghiệm sáng tạo do tôi thiết kế và triển khai.',
  canonical,
  structuredData: [
    buildPersonSchema(canonical, {
      url: canonical,
    }),
    {
      '@type': 'CollectionPage',
      name: 'Danh mục dự án cá nhân',
      url: canonical,
      description:
        'Tổng hợp các dự án cá nhân nổi bật: công cụ nội bộ, ứng dụng web và trải nghiệm sáng tạo tôi phát triển.',
      mainEntity: buildPersonSchema(canonical),
    },
  ],
};
---

<Layout metadata={metadata}>
  <Fragment slot="header">
    <Header
      links={[
        { text: 'Trang chủ', href: '#' },
        { text: 'Dự án', href: '#projects' },
        { text: 'Kỹ năng', href: '#skills' },
        { text: 'Blog', href: '#blog' },
        { text: 'GitHub', href: 'https://github.com/ptndz' },
      ]}
      actions={[{ text: 'Liên hệ', href: getPermalink('/contact#form') }]}
      isSticky
      showToggleTheme
    />
    <script is:inline src="/particles.min.js"></script>
  </Fragment>

  <!-- Hero -->

  <Hero
    id="hero"
    title="Phạm Thành Nam"
    tagline="Lập trình viên Fullstack & Người làm cà phê ☕"
    actions={[{ variant: 'primary', text: 'Hợp tác cùng tôi', href: getPermalink('/contact#form') }]}>
    <Fragment slot="subtitle">
      Tôi là một lập trình viên web đam mê xây dựng <b>ứng dụng hiện đại, công cụ sáng tạo và kiến trúc hệ thống</b>.<br
      />
      Từ <b>backend Node.js</b> đến <b>frontend React</b> và <b>microservice Go</b> - tôi biến ý tưởng thành sản phẩm vận
      hành ổn định và đẹp mắt.
    </Fragment>
    <Fragment slot="bg">
      <div id="hero-particles" class="absolute inset-0 pointer-events-none">
        <div
          class="absolute inset-0 bg-gradient-to-br from-indigo-100/60 via-white/0 to-blue-200/50 dark:from-slate-900 dark:via-slate-900/30 dark:to-indigo-950">
        </div>
      </div>

      <script type="module" is:inline>
        const PARTICLE_CONTAINER_ID = 'hero-particles';
        const particlesConfig = {
          particles: {
            number: {
              value: 90,
              density: { enable: true, value_area: 900 },
            },
            color: { value: ['#6366f1', '#8b5cf6', '#06b6d4'] },
            shape: {
              type: 'circle',
            },
            opacity: {
              value: 0.45,
              random: true,
            },
            size: {
              value: 3,
              random: true,
            },
            line_linked: {
              enable: true,
              distance: 150,
              color: '#6366f1',
              opacity: 0.35,
              width: 1,
            },
            move: {
              enable: true,
              speed: 1.2,
              direction: 'none',
              random: false,
              straight: false,
              out_mode: 'out',
              bounce: false,
            },
          },
          interactivity: {
            detect_on: 'window',
            events: {
              onhover: {
                enable: true,
                mode: 'grab',
              },
              onclick: {
                enable: false,
              },
              resize: true,
            },
            modes: {
              grab: {
                distance: 180,
                line_linked: { opacity: 0.5 },
              },
            },
          },
          retina_detect: true,
        };

        const destroyExistingInstance = () => {
          if (!window.pJSDom?.length) return;
          window.pJSDom = window.pJSDom.filter((instance) => {
            if (instance?.pJS?.canvas?.el?.parentElement?.id !== PARTICLE_CONTAINER_ID) {
              return true;
            }
            instance?.pJS?.fn?.vendors?.destroy?.();
            return false;
          });
        };

        const createParticles = () => {
          const container = document.getElementById(PARTICLE_CONTAINER_ID);
          if (!container || typeof window === 'undefined' || typeof window.particlesJS !== 'function') {
            return;
          }

          destroyExistingInstance();
          container.innerHTML = '<div class="absolute inset-0"></div>';
          window.particlesJS(PARTICLE_CONTAINER_ID, particlesConfig);
        };

        const initParticles = () => {
          if (document.readyState === 'complete' || document.readyState === 'interactive') {
            requestAnimationFrame(createParticles);
          } else {
            window.addEventListener('DOMContentLoaded', () => requestAnimationFrame(createParticles), { once: true });
          }
        };

        document.addEventListener('astro:after-swap', initParticles);
        document.addEventListener('astro:page-load', initParticles);
      </script>
    </Fragment>
  </Hero>

  <!-- About -->
  <Content
    id="about"
    columns={3}
    image={{
      src: logo,
      alt: 'Phạm Thành Nam',
      loading: 'lazy',
    }}>
    <Fragment slot="content">
      <h2 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">Về tôi</h2>
      <p>
        Tôi là lập trình viên fullstack với niềm vui <b>xây dựng và tối ưu ứng dụng</b>. Tôi tạo ra những hệ thống dung
        hòa kỹ thuật và sáng tạo - từ
        <b>trình biên tập React</b> đến <b>reverse proxy viết bằng Go</b> hay <b>nền tảng thanh toán nội bộ</b>.
      </p>
      <br />
      <p>
        Ngoài việc viết code, tôi còn là một <b>người trồng cà phê</b> - sự kết hợp giữa công nghệ và cuộc sống nông trại
        giúp tôi tạo ra quy trình hiệu quả hơn và sản phẩm tốt hơn.
      </p>
    </Fragment>
  </Content>

  <!-- Experience -->
  <Steps
    id="resume"
    title="Kinh nghiệm"
    items={[
      {
        title:
          'Fullstack Developer <br /> <span class="font-normal">Freelance / Independent</span> <br /> <span class="text-sm font-normal">2017 - Hiện tại</span>',
        description:
          'Thiết kế và phát triển ứng dụng web với Node.js, React, Prisma, PostgreSQL và Docker. Xây CMS tuỳ chỉnh, tích hợp thanh toán và các công cụ chỉnh sửa sáng tạo. Tư vấn kiến trúc và triển khai có khả năng mở rộng.',
        icon: 'tabler:code',
      },
      {
        title:
          'System Builder <br /> <span class="font-normal">Dự án cá nhân & khởi nghiệp</span> <br /> <span class="text-sm font-normal">Liên tục</span>',
        description:
          'Tạo ra "UI Builder" (trình dựng giao diện kéo thả bằng React), "Story Composer" (trình biên tập media với Konva + FFmpeg) và reverse proxy viết bằng Go lấy cảm hứng từ Caddy. Quản lý hạ tầng bằng PM2, Docker Compose và Nginx Proxy Manager.',
        icon: 'tabler:terminal',
      },
    ]}
    classes={{ container: 'max-w-3xl' }}
  />

  <!-- Skills - Lazy loaded -->
  <Features3
    id="skills"
    title="Kỹ năng kỹ thuật"
    subtitle="Sự kết hợp giữa kỹ thuật, sáng tạo và kinh nghiệm DevOps."
    columns={3}
    classes={{ container: 'motion-safe:md:intersect:animate-fade' }}
    items={[
      { title: 'Frontend', description: 'React, Next.js, Astro, TailwindCSS, Shadcn UI' },
      { title: 'Backend', description: 'Node.js (Express/Fastify), Go, PHP, Prisma ORM' },
      { title: 'Cơ sở dữ liệu', description: 'PostgreSQL, MySQL, Redis' },
      { title: 'DevOps', description: 'Docker, PM2, Nginx Proxy Manager, triển khai VPS' },
      { title: 'Công cụ sáng tạo', description: 'FFmpeg, Three.js, Konva.js, huấn luyện mô hình YOLO' },
      { title: 'Kiến trúc', description: 'Monorepo dạng mô-đun, thiết kế API, hệ thống định tuyến mở rộng' },
    ]}
  />

  <!-- Projects -->
  <Content
    id="projects"
    title="Dự án tiêu biểu"
    subtitle="Những dấu ấn trong hành trình xây hệ thống mở rộng và công cụ sáng tạo."
    isReversed
    items={[
      {
        title: 'UI Builder (React)',
        description:
          'Trình biên tập kéo thả để tạo component giao diện động dựa trên JSON registry và Zustand store. Xây dựng bằng React 19, Tailwind và Shadcn UI.',
      },
      {
        title: 'Story Composer Pro',
        description:
          'Trình biên tập media trực quan với Node + React, sử dụng Konva.js và FFmpeg để tạo và render câu chuyện động với hiệu ứng, bộ lọc.',
      },
      {
        title: 'Go Reverse Proxy',
        description:
          'Proxy server viết bằng Go, lấy cảm hứng từ Caddy - hỗ trợ cấp chứng chỉ tự động, định tuyến theo tên miền và cấu hình qua JSON.',
      },
    ]}
    image={{
      src: 'https://images.unsplash.com/photo-1556761175-5973dc0f32e7?auto=format&fit=crop&w=870&q=80',
      alt: 'Trình diễn dự án',
      loading: 'lazy',
      widths: [400, 768, 870],
      sizes: '(max-width: 768px) 400px, 870px',
    }}
    callToAction={{
      text: 'Xem thêm trên GitHub',
      href: 'https://github.com/ptndz',
      icon: 'tabler:chevron-right',
    }}
  />

  <!-- Testimonials - Lazy loaded -->
  <Testimonials
    title="Cộng sự nhận xét"
    subtitle="Mọi người đánh giá cao sự rõ ràng, chính xác và tinh thần sáng tạo của tôi."
    classes={{ container: 'motion-safe:md:intersect:animate-fade' }}
    testimonials={[
      {
        testimonial:
          'Nam là sự kết hợp hiếm hoi giữa kỹ sư và nhà thiết kế — anh ấy xây dựng hệ thống vừa vững chắc về kỹ thuật vừa tinh tế trong trải nghiệm người dùng.',
        name: 'Đồng nghiệp lập trình',
        job: 'Kỹ sư Fullstack',
      },
      {
        testimonial:
          'Làm việc với Nam rất trôi chảy — anh ấy dự đoán vấn đề sớm và bàn giao codebase có khả năng mở rộng, dễ bảo trì.',
        name: 'Cộng sự công nghệ',
        job: 'Kiến trúc sư phần mềm',
      },
      {
        testimonial:
          'Khả năng tư duy hệ thống và tính tổ chức của Nam giúp đội ngũ tiết kiệm rất nhiều thời gian khi triển khai sản phẩm.',
        name: 'Quản lý dự án',
        job: 'Project Manager',
      },
      {
        testimonial:
          'Anh ấy luôn giữ thái độ cầu thị và tôn trọng mọi ý kiến — nhờ đó, các cuộc trao đổi kỹ thuật với Nam luôn mang lại kết quả tích cực.',
        name: 'Cộng sự thiết kế',
        job: 'UI/UX Designer',
      },
      {
        testimonial:
          'Nam là người truyền cảm hứng — anh ấy thường chia sẻ kiến thức và hỗ trợ thành viên mới học hỏi nhanh chóng, bắt nhịp dự án chỉ trong vài ngày.',
        name: 'Đồng đội phát triển',
        job: 'Frontend Developer',
      },
      {
        testimonial:
          'Sự chuyên nghiệp và trách nhiệm của Nam khiến tôi hoàn toàn yên tâm khi giao các dự án quan trọng. Anh ấy không chỉ hoàn thành, mà luôn làm vượt mong đợi.',
        name: 'Khách hàng hợp tác',
        job: 'Founder & CEO',
      },
    ]}
  />

  <!-- Call to Action - Lazy loaded -->
  <CallToAction
    title="Cùng xây điều tuyệt vời"
    subtitle="Sẵn sàng cho hợp tác, tư vấn và những thử nghiệm sáng tạo."
    classes={{ container: 'motion-safe:md:intersect:animate-fade' }}
    actions={[{ variant: 'primary', text: 'Xem GitHub', href: 'https://github.com/ptndz' }]}
  />

  <!-- Blog -->
  <BlogLatestPosts
    id="blog"
    title="Bài viết mới"
    information="Tôi viết về JavaScript, React, Go và hành trình xây hệ thống sáng tạo - mời bạn khám phá những bài viết gần đây.">
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </BlogLatestPosts>
</Layout>
